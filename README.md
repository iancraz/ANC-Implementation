# Active Noise Cancelling Implementation

Nowadays, active noise cancellation is applied in the most diverse contexts, from industry to medicine and consumer products. This research work refers to the different noise cancellation systems commonly used. In addition, it analyzes the different adaptive algorithms that can be used for the implementation of these systems. The [Paper](https://github.com/iancraz/TP4---Investigacion/blob/master/Paper.pdf) (in Spanish) emphasizes the Broadband Feedforward cancellation system both in its practical aspects and in its implementation. Its implementation is explored with the FxLMS algorithms and its recursive FxLMS algorithm variant, FxRLS.


# Table of contents

* [Introduction](#Introduction)
* [Dataset](#Dataset)
* [Quick-Reference](#Quick-Reference)
* [Training](#Training)
* [Training](#training)
* [Contact](#Contact)
* [License](#License)

# Introduction
>[Table of contents](#table-of-contents)

Active noise cancellation is a method for the elimination of one wave by the addition of another. It is implemented by means of an electroacoustic or electromechanical system that takes advantage of the phenomenon of destructive interference. To to achieve this, it uses a wave with equal amplitude but inverted phase with respect to the noise wave. Consequently, the combination of both waves results in the cancellation of both noises. As will be discussed later, noise cancellation systems, or ANC, are very effective in eliminating low frequency noise. This led to a great development of this topic in the industry because generally passive noise cancellation systems fail to eliminate low-frequency noise.

Noise can vary in frequency, amplitude, phase, speed of sound and can be caused by an infinite number of sources. This very nature of noise implies that ANC systems must have an adaptive filter that allows modifying to all the above mentioned variables. Adaptive filters adjust their coefficients, generally called "weights", to minimize the error signal. The coefficients can be determined by several algorithms, the most widely used is the least mean squares algorithm or LMS for its acronym in English. In addition, there are other algorithms such as NLMS, FxLMS, FxRLS, etc. These will be discussed later.  This type of filters can be performed with finite response filters (FIR) and infinite response filters (IIR). As FIR filters are generally used, this is the type of filter that will be used in this work.

In this research work, noise is defined as any undesirable sound that you want to eliminate, noise generated by machines, ambient noise, conversations in a cafe, etc.. In other words, noise can be generated by any means. 

ANC systems can be based on pre-feedback or **feedforward**, where the reference noise is sampled before it propagates to the second source, or on **feedback** where the noise is cancelled without a reference. That is, the signal is sampled after the injection of the canceling wave to correct the cancellation error.  

Within the feedforward systems are **1** the narrowband systems that will be presented in the section [Feedforward](#Feedforward) and **2)** the broadband systems that will be discussed in the section [Feedforward](#Feedforward). On the other hand, within the feedback systems is the adaptive narrowband system which will be introduced in section [FeedBack](#Feedback). 


# FeedForward Systems
>[Table of contents](#table-of-contents)

## Narrowband Feedforward

In many ANC applications noise signals are periodic. These signals can be generated by machines such as motors, fans, compressors, etc. This system uses the periodicity of these signals to cancel the noise. This type of system has the following advantages:

* Noise feedback from the noise-cancelling speaker to the reference microphone is avoided.
* Alignments of the reference microphone are avoided.
* As it is periodic noise, the causality constraint is eliminated.
* The possibility of generating reference signals allows to control each harmonic independently.
* It is only necessary to model the transfer function on frequencies close to that of the harmonics.

<img src="https://github.com/iancraz/TP4---Investigacion/blob/master/docs/Feedforward/diagrama_narrow.png?raw=true" width=300 align=center>

A basic diagram of such a system is shown in the previous Figure. The system has a sensor that acts as the trigger of the signal generator. The reference signal generated can be of two types: **1)** a pulse train with period equal to the inverse of the fundamental frequency of the periodic noise and **2)** sine waves with the same frequencies as the harmonics of the periodic noise. To implement the **1)** type the method called wave synthesis is used while for the **2)** type an adaptive notch filter is used. No matter what type of reference signal is generated, it is processed by an adaptive filter and sent to the driver. By means of an error signal the adaptive filter is modified (thanks to different algorithms) to minimize the error. 

The math details of the calculation of the synthesis method can be found in the [Paper](https://github.com/iancraz/TP4---Investigacion/blob/master/Paper.pdf) (in Spanish).

## Broadband FeedForward

The system is illustrated in following Figure. The system has a reference microphone that takes the input signal, the signal is processed by the ANC system that reproduces a signal in the cancellation speaker. It has an error microphone that modifies the behavior of the adaptive filter to minimize the error of the ANC system. 

<img src="https://github.com/iancraz/TP4---Investigacion/blob/master/docs/Feedforward/diagrama_broadband.png?raw=true" width=300 align=center>

The primary path **P(z)** is defined as the acoustic path between the coordinates near the reference microphone and the error microphone. There are also two secondary paths from the cancellation speaker to the reference signal **S_1(z)** on one side and to the error microphone **S_2(z)** on the other side. The adaptive filter **W(z)** is used to estimate **P(z)** to generate a noise cancelling signal.

To clarify the operation of the system, a block diagram of the system, it is illustrated in the following Figure. The error microphone is depicted as the adder module whose input signals are **d(n)** and **y(n)**. The system seeks to modify **W(z)** so that **y(n)** and **-d(n)** have maximum correlation with each other. If this is achieved, when combining both signals, the residual error is **e(n) = d(n) + y(n) = 0** since as they have maximum correlation the output will be white Gaussian noise.

<img src="https://github.com/iancraz/TP4---Investigacion/blob/master/docs/Feedforward/bloques_broadband.png?raw=true" width=300 align=center>

With this block in mind, one can calculate the transfer function of this system, once again found in the [Paper](https://github.com/iancraz/TP4---Investigacion/blob/master/Paper.pdf) (in Spanish).

Finalizing the study of this type of systems it is not superfluous to mention the importance of the processing time. After the reference microphone takes the input signal, the system has a certain time to generate the signal from the cancellation speaker. If the time it takes to generate this signal (electronic delay) is longer than the time it takes for the noise to get from the reference microphone to the driver (acoustic delay), the efficiency of the system is severely impaired. This is because the system response is non-causal when the electronic delay is greater than the acoustic delay. When the causality condition is achieved the system is able to suppress random noises. On the contrary, if the causality condition is not achieved, the system can only eliminate periodic noises. As a last clarification note that this system is not limited to periodic noises, this makes it somehow superior to the previous system. That is why this system has more applications than the Narrowband Feedforward system. 















# Quick Reference
>[Table of contents](#table-of-contents)

To run this example, you need to clone this repository:

```
git clone https://github.com/iancraz/Pix2Pix-Image-Colorizer.git
```

# Training
>[Table of contents](#table-of-contents)


<img src="https://github.com/iancraz/Pix2Pix-Image-Colorizer/blob/main/docs/0_0.jpg?raw=true" width=300 align=center>



# Contact
>[Table of contents](#table-of-contents)

Please do not hesitate to reach out to me if you find any issue with the code or if you have any questions.

* Personal email: [idiaz@itba.edu.ar](mailto:idiaz@itba.edu.ar)

* LinkedIn Profile: [https://www.linkedin.com/in/iancraz/](https://www.linkedin.com/in/iancraz/)

# License
>[Table of contents](#table-of-contents)

```
MIT License

Copyright (c) 2021 Ian Cruz Diaz

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
SOFTWARE.
```